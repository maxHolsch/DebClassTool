name = "deliberatorium"
main = "worker/worker.ts"
compatibility_date = "2024-12-30"
compatibility_flags = ["nodejs_compat"]
assets = { not_found_handling = "single-page-application" }
preview_urls = true

[observability]
enabled = true

# Durable Objects
[durable_objects]
bindings = [
    { name = "AGENT_DURABLE_OBJECT", class_name = "AgentDurableObject" },
    { name = "SYNC_DURABLE_OBJECT", class_name = "TldrawSyncDurableObject" },
]

# R2 bucket for asset uploads (images/media)
[[r2_buckets]]
binding = "ASSETS_BUCKET"
bucket_name = "deliberatorium-assets"
preview_bucket_name = "deliberatorium-assets-preview"

# Durable objects require migrations to create/modify/delete them
# Fresh deploy â€” both DOs use SQLite (required for free plan)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["AgentDurableObject", "TldrawSyncDurableObject"]
